@model Core.Model.User

@{
    ViewBag.Title = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<section class="about-nav mt-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                <h2>edit profile</h2>
            </div>
            <div class="row">
                <div class="col-lg-9 col-md-9 col-sm-9 col-12 mt-5">
                    <div class="edit-form">
                        <form id="ProfileForm">
                            @Html.AntiForgeryToken()

                            <div class="col-lg-2 col-md-2 col-sm-2 col-12 mt-5 pt-3">
                                <div class="edit-nav mt-5">
                                    <i id="ImageOpener" class="fa fa-edit fa-2x"></i>
                                    <img style="width:200px;height:200px" src="@Model.Image" id="blah" />
                                    <input style="display:none" name="UserImage" accept=".Jpg, .png, .jpg, jpeg" type='file' id="File" onchange="GetBase64(this);" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>First Name</label>
                                    <input type="text" class="form-control" required="" value="@Model.FirstName" name="FirstName">
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>Last Name</label>
                                    <input type="text" class="form-control" required="" value="@Model.LastName" name="LastName">
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>E mail</label>
                                    <input readonly type="text" class="form-control" required="" value="@Model.EmailAddress" name="EmailAddress">
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>Mobile Number</label>
                                    <input type="text" class="form-control" required="" value="@Model.MobileNumber" name="MobileNumber">
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>Company Name</label>
                                    <input type="text" class="form-control" required="" value="@Model.CompanyName" name="CompanyName">
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>Job Title</label>
                                    <input type="text" class="form-control" required="" value="@Model.JobTitle" name="JobTitle" />
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>Company’s Account Information (optional) </label>
                                    <input type="text" class="form-control" required="" value="@Model.CompanyAccountInformation" name="CompanyAccountInformation">
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>Date of Birth</label>
                                    <input type="text" class="form-control" required="" value="@Model.DOB.Date.ToString("MM/dd/yyyy")" name="DOB">
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>Address</label>
                                    <input type="text" class="form-control" required="" value="@Model.Address" name="Address">
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <div class="row">
                                        <div class="col form-group mb-2">
                                            <label>City</label>
                                            <input type="text" class="form-control" required="" value="@Model.City" name="City">
                                        </div>
                                        <div class="col form-group mb-2">
                                            <label>State</label>

                                            <select name="StateID" class="form-select sel State" aria-label="Default select example">
                                            </select>
                                        </div>
                                        <div class="col form-group mb-2">
                                            <label>Zip Code</label>
                                            <input type="text" class="form-control" required="" value="@Model.ZipCode" name="ZipCode">
                                        </div>
                                    </div>
                                </div>



                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>Password</label>
                                    <input type="password" id="password-field1" class="form-control Password" value="@Model.Password" required=""> <span toggle="#password-field1" class="pr-5 far fa-fw field-icon toggle-password fa-eye"></span>
                                </div>
                                <div class="col-md-6 col-12 form-group mb-2">
                                    <label>Confirm password</label>
                                    <input type="password" id="password-field2" class="form-control CPassword" value="@Model.Password" name="Password" required=""> <span toggle="#password-field2" class="pr-5 far fa-fw field-icon toggle-password fa-eye"></span>
                                </div>


                                <div class="col-md-2 ms-auto">
                                    <input type="submit" value="Submit" class="button-primary btn btn-primary log-b pe-5  ps-5 pt-2 pb-2 mb-4 mt-4" />
                                </div>


                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>



<script>
    function GetBase64(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#blah')
                    .attr('src', e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    $(function () {

        $('[name= DOB]').datepicker({
            format: 'mm-dd-yyyy'
        });


        $.get("/Home/GetStates").done(function (resp) {
            var options = '<option value="">Select</option>';
            for (var i = 0; i < resp.data.length; i++) {
                options += '<option value="' + resp.data[i].id + '">' + resp.data[i].StateName + '</option>';

            }
            debugger
            $('.State').html(options);

            $('.State').val('@Model.StateID');
            var sdas = $('.State').val();
        }).fail(function (data) {
            toastr["error"](data)
        });
    });


    $(document).on('click', "#ImageOpener", function (e) {

        $('#File').click();
    });
    $(document).on('submit', "#ProfileForm", function (e) {

        e.preventDefault();

        if ($('.Password').val() != $('.CPassword').val()) {
            toastr["info"]("Password & confirm password must be matched")
        }
        else {

            debugger
            var formData = new FormData(this);
            $.ajax({
                url: '/User/UpdateProfile',
                type: "POST",
                dataType: "JSON",
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (resp) {
                    debugger
                    if (resp.isSuccess) {
                        toastr["info"](resp.msg)
                        window.location.reload()
                    } else {
                        toastr["error"](resp.msg)
                    }
                }
            });

        }
    })
</script>